<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>AngularJS Interceptor by AmitThakkar</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">AngularJS Interceptor</h1>
      <h2 class="project-tagline">This repository for containing Interceptor DEMO.</h2>
      <a href="https://github.com/AmitThakkar/AngularJS-Interceptor" class="btn">View on GitHub</a>
      <a href="https://github.com/AmitThakkar/AngularJS-Interceptor/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/AmitThakkar/AngularJS-Interceptor/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="angularjs-interceptor" class="anchor" href="#angularjs-interceptor" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>AngularJS Interceptor</h1>

<p>This is repository for containing <strong>Angular Interceptor</strong> DEMO.</p>

<p>When we are working on <strong>AngularJS</strong> then <strong>AngularJS</strong>'s core service <strong>$http</strong> helps us to communicate with remote HTTP Server via ajax request. Let's first see a small demo of <strong>$http</strong> service then we will move to the concept of <strong>interceptors</strong>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// $http service injecting to Controller via DI.</span>
<span class="pl-smi">interceptorModule</span>.<span class="pl-en">controller</span>(<span class="pl-s"><span class="pl-pds">"</span>InterceptorController<span class="pl-pds">"</span></span>, [<span class="pl-s"><span class="pl-pds">"</span>$http<span class="pl-pds">"</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$http</span>) {
    <span class="pl-c">// Defining successHandler for success status.</span>
    <span class="pl-k">function</span> <span class="pl-en">successHandler</span>(<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
        <span class="pl-c">// This will be called asynchronously when response will come with success status.</span>
    }

    <span class="pl-c">// Defining errorHandler for error status.</span>
    <span class="pl-k">function</span> <span class="pl-en">errorHandler</span>(<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
        <span class="pl-c">// This will be called asynchronously when response will come with error status.</span>
    }

    <span class="pl-c">// Hitting get request on someUrl and providing successHandler in success function</span>
    <span class="pl-c">// and errorHandler in error function. successHandler will be called when response will come</span>
    <span class="pl-c">// with success status and errorHandler will be called when response will come with error status.</span>
    <span class="pl-en">$http</span>({method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/someUrl<span class="pl-pds">'</span></span>})
        .<span class="pl-en">success</span>(successHandler)
        .<span class="pl-en">error</span>(errorHandler);
}]);</pre></div>

<p>Many a times we load data via ajax request. And for authenticating our request on server, we need to pass token/jsessionid with each request. For passing the token/jsessionid with each request, we manually add token/jsessionid to each ajax request before hitting. e.g.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">$http</span>({method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/someUrl1<span class="pl-pds">'</span></span>, headers<span class="pl-k">:</span> {Authorization<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>token<span class="pl-pds">'</span></span>}})
    .<span class="pl-en">success</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
    })
    .<span class="pl-en">error</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
    });
<span class="pl-en">$http</span>({method<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, url<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/someUrl2<span class="pl-pds">'</span></span>, headers<span class="pl-k">:</span> {Authorization<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>token<span class="pl-pds">'</span></span>}})
    .<span class="pl-en">success</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
    })
    .<span class="pl-en">error</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
    });</pre></div>

<p>And now suppose response is coming into XML/JSON format, and we have to parse each and every response and if we get unauthorized response error then we have to redirect/open to login page, then you might be thinking to write a custom <strong>service</strong> for this e.g.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">interceptorModule</span>.<span class="pl-en">service</span>(<span class="pl-s"><span class="pl-pds">'</span>CustomRequestService<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">"</span>$http<span class="pl-pds">"</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$http</span>) {
    <span class="pl-v">this</span>.<span class="pl-en">sendRequest</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">method</span>, <span class="pl-smi">url</span>, <span class="pl-smi">successHandler</span>, <span class="pl-smi">errorHandler</span>) {
        <span class="pl-en">$http</span>({method<span class="pl-k">:</span> method, url<span class="pl-k">:</span> url, headers<span class="pl-k">:</span> {Authorization<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>token<span class="pl-pds">'</span></span>}})
            .<span class="pl-en">success</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
                <span class="pl-c">// parse response data and pass to successHandler</span>
                <span class="pl-en">successHandler</span>(<span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(data), status, headers, config);
            })
            .<span class="pl-en">error</span>(<span class="pl-k">function</span> (<span class="pl-smi">data</span>, <span class="pl-smi">status</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">config</span>) {
                <span class="pl-c">// if unauthorized error returned then redirect/open login page here, call errorHandler otherwise</span>
                <span class="pl-en">errorHandler</span>(<span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(data), status, headers, config);
            });
    };
}]);</pre></div>

<p>Above way is nice to achieve the interceptor behavior. But few things, which I don't like about this. There can be many, but I am listing down few of them, e.g.</p>

<ul>
<li>We have to consume CustomRequestService in all the places instead of <strong>$http service</strong>. </li>
<li>Suppose my parsing logic takes 4 steps so I have to put all 4 steps into this single service/place.</li>
<li>We cannot make independent module, which communicates with <strong>$http service</strong>. etc.</li>
</ul>

<p><strong>AngularJS</strong> provides us functionality to write <strong>interceptors</strong>. Let's first try small interceptor example:</p>

<p><strong>angular-interceptor.html</strong></p>

<div class="highlight highlight-text-html-basic"><pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span> <span class="pl-e">ng-app</span>=<span class="pl-s"><span class="pl-pds">"</span>interceptorDemo<span class="pl-pds">"</span></span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">title</span>&gt;Angular Interceptor&lt;/<span class="pl-ent">title</span>&gt;
    <span class="pl-c">&lt;!-- Require AngularJS --&gt;</span>
<span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>application/javascript<span class="pl-pds">"</span></span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>js/angular.min.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span>
    <span class="pl-c">&lt;!-- Require our custom interceptorJS --&gt;</span>
<span class="pl-s1">    &lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>application/javascript<span class="pl-pds">"</span></span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>js/interceptor.js<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</span>
&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span> <span class="pl-e">ng-controller</span>=<span class="pl-s"><span class="pl-pds">"</span>InterceptorController as interceptorCtrl<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">h1</span> <span class="pl-e">ng-bind</span>=<span class="pl-s"><span class="pl-pds">"</span>interceptorCtrl.demo<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">h1</span>&gt;
&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>

<p><strong>interceptor.js</strong></p>

<div class="highlight highlight-source-js"><pre>(<span class="pl-k">function</span> () {
    <span class="pl-k">var</span> interceptorModule <span class="pl-k">=</span> <span class="pl-smi">angular</span>.<span class="pl-en">module</span>(<span class="pl-s"><span class="pl-pds">"</span>interceptorDemo<span class="pl-pds">"</span></span>, []);
    <span class="pl-smi">interceptorModule</span>.<span class="pl-en">controller</span>(<span class="pl-s"><span class="pl-pds">"</span>InterceptorController<span class="pl-pds">"</span></span>, [<span class="pl-s"><span class="pl-pds">"</span>$http<span class="pl-pds">"</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$http</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Controller executing.<span class="pl-pds">"</span></span>);
        <span class="pl-v">this</span>.<span class="pl-smi">demo</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Interceptor Demo<span class="pl-pds">"</span></span>;
        <span class="pl-smi">$http</span>.<span class="pl-c1">get</span>(<span class="pl-s"><span class="pl-pds">"</span>README.md<span class="pl-pds">"</span></span>)
            .<span class="pl-en">success</span>(<span class="pl-k">function</span> () {
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Success returned<span class="pl-pds">"</span></span>);
            })
    }]);
    <span class="pl-c">// Defining an interceptor with name interceptor1</span>
    <span class="pl-smi">interceptorModule</span>.<span class="pl-en">factory</span>(<span class="pl-s"><span class="pl-pds">'</span>interceptor1<span class="pl-pds">'</span></span>, [<span class="pl-k">function</span> () {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Interceptor1 initializing.<span class="pl-pds">"</span></span>);
        <span class="pl-c">// defining interceptor configuration.</span>
        <span class="pl-k">var</span> interceptor <span class="pl-k">=</span> {
            <span class="pl-c">// defining a method, which will be called before sending the request.</span>
            <span class="pl-en">request</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">config</span>) {
                <span class="pl-c">// attaching token/jsessionid code will come here.</span>
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executing before request of interceptor1<span class="pl-pds">"</span></span>);
                <span class="pl-k">return</span> config;
            },
            <span class="pl-c">// defining a method, which will be called after response received.</span>
            <span class="pl-en">response</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">response</span>) {
                <span class="pl-c">// parsing the response logic will come here.</span>
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executing after response of interceptor1<span class="pl-pds">"</span></span>);
                <span class="pl-k">return</span> response;
            }
        };
        <span class="pl-c">// returning interceptor configuration.</span>
        <span class="pl-k">return</span> interceptor;
    }]);
    <span class="pl-c">// Defining an interceptor with name interceptor2</span>
    <span class="pl-smi">interceptorModule</span>.<span class="pl-en">service</span>(<span class="pl-s"><span class="pl-pds">'</span>interceptor2<span class="pl-pds">'</span></span>, [<span class="pl-s"><span class="pl-pds">"</span>$q<span class="pl-pds">"</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$q</span>) {
        <span class="pl-c">// defining interceptor configuration.</span>
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Interceptor2 initializing.<span class="pl-pds">"</span></span>);
        <span class="pl-c">// defining a method, which should will be called before sending the request.</span>
        <span class="pl-v">this</span>.<span class="pl-en">request</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">config</span>) {
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executing before request of interceptor2<span class="pl-pds">"</span></span>);
            <span class="pl-c">// If you want to do some async work before sending the request then use $q service and return promise.</span>
            <span class="pl-k">var</span> deferred <span class="pl-k">=</span> <span class="pl-smi">$q</span>.<span class="pl-c1">defer</span>();
            <span class="pl-c1">setTimeout</span>(<span class="pl-k">function</span> () {
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executed before request of interceptor2<span class="pl-pds">"</span></span>);
                <span class="pl-smi">deferred</span>.<span class="pl-en">resolve</span>(config);
            }, <span class="pl-c1">100</span>);
            <span class="pl-k">return</span> <span class="pl-smi">deferred</span>.<span class="pl-smi">promise</span>;
        };
        <span class="pl-c">// defining a method, which will be called after response received.</span>
        <span class="pl-v">this</span>.<span class="pl-en">response</span> <span class="pl-k">=</span> <span class="pl-k">function</span> (<span class="pl-smi">response</span>) {
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executing after response of interceptor2<span class="pl-pds">"</span></span>);
            <span class="pl-c">// If you want to do some async work after response received then use $q service and return promise.</span>
            <span class="pl-k">var</span> deferred <span class="pl-k">=</span> <span class="pl-smi">$q</span>.<span class="pl-c1">defer</span>();
            <span class="pl-c1">setTimeout</span>(<span class="pl-k">function</span> () {
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">"</span>Executed after response of interceptor2<span class="pl-pds">"</span></span>);
                <span class="pl-smi">deferred</span>.<span class="pl-en">resolve</span>(response);
            }, <span class="pl-c1">100</span>);
            <span class="pl-k">return</span> <span class="pl-smi">deferred</span>.<span class="pl-smi">promise</span>;
        }
    }]);
    <span class="pl-c">// Adding interceptor1 and interceptor2 to interceptor list.</span>
    <span class="pl-smi">interceptorModule</span>.<span class="pl-en">config</span>([<span class="pl-s"><span class="pl-pds">'</span>$httpProvider<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> (<span class="pl-smi">$httpProvider</span>) {
        <span class="pl-c">// To add custom interceptor, we have to use $httpProvider, And push custom interceptor to interceptors.</span>
        <span class="pl-smi">$httpProvider</span>.<span class="pl-smi">interceptors</span>.<span class="pl-c1">push</span>(<span class="pl-s"><span class="pl-pds">'</span>interceptor1<span class="pl-pds">'</span></span>);
        <span class="pl-smi">$httpProvider</span>.<span class="pl-smi">interceptors</span>.<span class="pl-c1">push</span>(<span class="pl-s"><span class="pl-pds">'</span>interceptor2<span class="pl-pds">'</span></span>);
    }]);
})();</pre></div>

<p>Now run the application and open console, you will see some log messages as shown in image below:</p>

<p><img src="https://raw.githubusercontent.com/AmitThakkar/AngularJS-Interceptor/master/images/output.png" alt="output.png"></p>

<p>We can see that when we hit a request then request method invokes first for all the interceptors in that order which they have been pushed into <strong>$httpProvider.interceptors</strong>. And response method invokes after response received for all the interceptors in reverse order of request method. After seeing this interceptor functionality we can say that we can add as many interceptors as we want and our controllers/module will be independent from our interceptor logic.</p>

<p><strong>AngularJS Interceptor</strong> have two more function/methods in interceptor configuration: <strong>requestError</strong> and <strong>responseError</strong>, If our <strong>interceptor's request</strong> method rejects the request on some condition, then <strong>requestError</strong> function will be called. It can be used to undo some work etc while <strong>responseError</strong> invoked when backend request fails.</p>

<h2>
<a id="follow-me" class="anchor" href="#follow-me" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Follow Me</h2>

<p><a href="https://github.com/AmitThakkar">Github</a></p>

<p><a href="https://twitter.com/amit_thakkar01">Twitter</a></p>

<p><a href="https://in.linkedin.com/in/amitthakkar01">LinkedIn</a></p>

<p><a href="https://amitthakkar.github.io/">More Blogs By Me</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/AmitThakkar/AngularJS-Interceptor">AngularJS Interceptor</a> is maintained by <a href="https://github.com/AmitThakkar">AmitThakkar</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
